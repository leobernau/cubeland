<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Bernau Games - CubeLand</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      font-family: Arial, sans-serif;
      color: white;
    }
    canvas {
      display: block;
    }
    #scoreboard {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      color: cyan;
      text-shadow: 0 0 8px #0ff;
    }
    #shop {
      display: none;
      position: absolute;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      width: 400px;
      height: 500px;
      overflow-y: scroll;
      background: rgba(0,0,0,0.85);
      border: 2px solid cyan;
      border-radius: 12px;
      color: white;
      padding: 20px;
    }
    .skin {
      margin: 10px;
      padding: 10px;
      border: 1px solid #0ff;
      cursor: pointer;
      border-radius: 8px;
    }
    .skin:hover {
      background: rgba(0,255,255,0.2);
    }
  </style>
</head>
<body>
  <div id="scoreboard">Score: 0 | Highscore: 0 | Coins: 0</div>
  <div id="shop">
    <h2>Shop</h2>
    <div id="skins"></div>
  </div>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Game variables
    let gameSpeed = 6;
    let gravity = 0.6;
    let jumpPower = -12; // höherer Sprung
    let score = 0;
    let highscore = 0;
    let coins = 0;
    let gameOver = false;
    let obstacles = [];
    let coinItems = [];

    // Player (Würfel)
    class Player {
      constructor() {
        this.size = 50;
        this.x = 150;
        this.y = canvas.height - this.size - 50;
        this.dy = 0;
        this.jumpStrength = jumpPower;
        this.grounded = false;
        this.rotation = 0;
      }
      draw() {
        ctx.save();
        ctx.translate(this.x + this.size/2, this.y + this.size/2);
        ctx.rotate(this.rotation * Math.PI/180);
        ctx.fillStyle = "black";
        ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
        ctx.strokeStyle = "cyan";
        ctx.lineWidth = 4;
        ctx.strokeRect(-this.size/2, -this.size/2, this.size, this.size);
        ctx.restore();
      }
      update() {
        this.y += this.dy;
        if (this.y + this.size < canvas.height - 50) {
          this.dy += gravity;
          this.grounded = false;
          this.rotation += 9; // dreht sich in der Luft
        } else {
          this.dy = 0;
          this.y = canvas.height - this.size - 50;
          this.grounded = true;
          this.rotation = 0; // richtet sich wieder aus
        }
        this.draw();
      }
      jump() {
        if (this.grounded) {
          this.dy = this.jumpStrength;
          this.grounded = false;
        }
      }
    }

    // Hindernis (Block oder Stachel)
    class Obstacle {
      constructor() {
        this.width = 50 + Math.random() * 50;
        this.height = 50 + Math.random() * 100;
        this.x = canvas.width;
        this.y = canvas.height - this.height - 50;
        this.type = Math.random() < 0.5 ? "block" : "spike";
      }
      draw() {
        ctx.fillStyle = "black";
        ctx.strokeStyle = this.type === "block" ? "lime" : "magenta";
        ctx.lineWidth = 3;
        if (this.type === "block") {
          ctx.fillRect(this.x, this.y, this.width, this.height);
          ctx.strokeRect(this.x, this.y, this.width, this.height);
        } else {
          ctx.beginPath();
          ctx.moveTo(this.x, this.y + this.height);
          ctx.lineTo(this.x + this.width/2, this.y);
          ctx.lineTo(this.x + this.width, this.y + this.height);
          ctx.closePath();
          ctx.fill();
          ctx.stroke();
        }
      }
      update() {
        this.x -= gameSpeed;
        this.draw();
      }
    }

    // Münzen
    class Coin {
      constructor(x, y) {
        this.size = 20;
        this.x = x;
        this.y = y - 40; // auf dem Block
      }
      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
        ctx.fillStyle = "gold";
        ctx.fill();
        ctx.strokeStyle = "orange";
        ctx.stroke();
      }
      update() {
        this.x -= gameSpeed;
        this.draw();
      }
    }

    const player = new Player();
    let frame = 0;

    function spawnObstacle() {
      if (frame % 120 === 0) {
        const obs = new Obstacle();
        obstacles.push(obs);
        if (obs.type === "block") {
          // Platziere eine Münze auf Blöcken
          coinItems.push(new Coin(obs.x + obs.width/2, obs.y));
        }
      }
    }

    function handleObstacles() {
      for (let i = obstacles.length-1; i >= 0; i--) {
        obstacles[i].update();
        if (obstacles[i].x + obstacles[i].width < 0) {
          obstacles.splice(i, 1);
          score++;
          if (score > highscore) highscore = score;
        }
      }
    }

    function handleCoins() {
      for (let i = coinItems.length-1; i >= 0; i--) {
        coinItems[i].update();
        if (coinItems[i].x + coinItems[i].size < 0) {
          coinItems.splice(i, 1);
        }
        // Collision
        if (player.x < coinItems[i]?.x + coinItems[i]?.size &&
            player.x + player.size > coinItems[i]?.x - coinItems[i]?.size &&
            player.y < coinItems[i]?.y + coinItems[i]?.size &&
            player.y + player.size > coinItems[i]?.y - coinItems[i]?.size) {
          coins++;
          coinItems.splice(i, 1);
        }
      }
    }

    function detectCollision() {
      for (let obs of obstacles) {
        if (obs.type === "block") {
          if (player.x < obs.x + obs.width &&
              player.x + player.size > obs.x &&
              player.y < obs.y + obs.height &&
              player.y + player.size > obs.y) {
            gameOver = true;
          }
        } else if (obs.type === "spike") {
          if (player.x < obs.x + obs.width &&
              player.x + player.size > obs.x &&
              player.y + player.size > obs.y) {
            gameOver = true;
          }
        }
      }
    }

    function animate() {
      if (gameOver) {
        ctx.fillStyle = "red";
        ctx.font = "48px Arial";
        ctx.fillText("Game Over - Press R", canvas.width/2 - 200, canvas.height/2);
        return;
      }
      ctx.clearRect(0,0,canvas.width,canvas.height);
      frame++;

      spawnObstacle();
      handleObstacles();
      handleCoins();
      detectCollision();
      player.update();

      ctx.fillStyle = "cyan";
      ctx.font = "24px Arial";
      ctx.fillText("Score: " + score + " | Highscore: " + highscore + " | Coins: " + coins, 30, 40);

      requestAnimationFrame(animate);
    }

    animate();

    // Steuerung
    window.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        player.jump();
      }
      if (e.code === "KeyR") {
        // Reset
        obstacles = [];
        coinItems = [];
        score = 0;
        gameOver = false;
        animate();
      }
      if (e.code === "KeyS") {
        const shop = document.getElementById("shop");
        shop.style.display = shop.style.display === "none" ? "block" : "none";
      }
    });
  </script>
</body>
</html>
